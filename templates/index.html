{% extends "layout.html" %}
{% block content %}

    <div class="container">

      <div class="header">
          <ul class="nav nav-pills pull-left">
              <li> <a href="#">February 8th 2100 PST</a></li>
          </ul>
        <ul class="nav nav-pills pull-right">
          <li class="active"><a href="/">Home</a></li>
          <li><a href="/about">About</a></li>
          <!--<li><a href="http://www.twitter.com/ecalifornica">Contact</a></li>-->
        </ul>
        <h3 class="text-muted">&nbsp</h3>
      </div>

        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-success">
        {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

      <div class="jumbotron">
        <h1>Happy Birthday Sohrob!</h1>
        <p class="lead">Our friend <a href="https://twitter.com/telotype">@telotype</a> has a horrible futon mattress.
        How do I know? It used to be my horrible mattress.
        I'm hoping that you will join me in buying him a better mattress for his birthday.</p>
        {% if signin %}
        <p><a class="btn btn-lg btn-success" href="/twitter-login/" role="button">Sign in with Twitter to Pledge</a></p>
        {% else %}
        {% endif %}

        {% if enteramount %}
        <p>
        <form action="/" method="post">
            <!-- ugly -->
            <span style="font-size:175%; font-weight:400;">$</span>
            <input type="text" size="5" maxlength="3" name="charge_amount" placeholder="{{ amount_placeholder }}">
            <!--this could be better with ajax-->
            <input class="btn btn-lg btn-success" type="submit" value="{{ amount_button }}">
        </form>
        </p>
        {% else %}
        {% endif %}

        {% if entercard %}
        <p>
        {{ charge_amount }}
        <form action="/charge" method="post">

        <script src="https://checkout.stripe.com/v2/checkout.js" class="stripe-button" 
            data-key="{{ key }}"
            data-amount="{{ amount }}"
            data-name="Twiftter"
            data-description="Happy Birthday Sohrob!"
            data-label="Enter Card Data"
            data-panel-label="Pledge"
            data-billing-address="true">
        </script>
        </form>
        </p>
        {% else %}
        {% endif %}
    </div>
    {% if thank_you %}
    <div class="jumbotron">
        <p>
        {{ thank_you }}
        </p>
    </div>
        {% endif %}

<!--
          <p><button class="btn btn-lg btn-success" id="customButton"  href="/twitter-login/" role="button">Enter Card Data</button></p>
-->
<!--</div>-->
<!--
      <div class="row marketing">
        <div class="col-lg-6">
        </div>
        -->
    <!--</div>-->
<!-- put the plot on its own row -->
<div class="row marketing" style="font:Helvetica Neue;">

          <!--<script src="static/plot.js"></script>-->
    <div id="barf" class="col-md-6">
        <h1 style="margin-left:63px;">{{ percentage_complete }}%</h1>
    </div>
    <!--
           <div class="col-md-2">
           </div>
    -->
           <div class="col-md-6">
               <div class="row">
                   <h1>Your choice:</h1>
               </div>
               <div class="row marketing">


        <form action="/vote/" method="post">
            <!-- ugly -->
            <!--this could be better with ajax-->
            <!--<input class="btn btn-default" type="submit" value="valuevote1" name="namevote1">-->

            <button type="submit" name="1" value="1" class="btn btn-default" id="voteid1">
                        <span style="font-size:150%;" class="glyphicon glyphicon-ok">
                    <h4>$300</h4></span>
            </button> 10 votes
        </form>


<img width="33px" src="static/images/profile_images/jmcclune.jpg">
<img width="33px" src="static/images/profile_images/pockerfish.jpg">
                    <a href="http://www.amazon.com/Signature-Sleep-Inch-Mattress-Queen/dp/B004LQ1RQU/ref=sr_1_9?m=ATVPDKIKX0DER&s=furniture&ie=UTF8&qid=1391081044&sr=1-9">
                       <h4>Amazon coil mattress</h4>
                       <span style="maring-left:-4px;"><img src="static/images/stars_reviews_2b.png"></span>
                    </a>
                       <span style="font-size:90%;padding-left:20px;">81 customer reviews</span>
                </div>

                <div class="row marketing">

        <!--<button type="button" name="test" class="btn btn-default" id="barfer">-->

        <a role="button" href="/vote/" name="mattress_vote" class="btn btn-default" id="mattress_vote_two">

                        <span style="font-size:150%;" class="glyphicon glyphicon-ok">
                            <h4>$400</h4>
                        </span>
                    </a> 
                        <!--</button>-->

                    &nbsp;<img width="33px" src="static/images/profile_images/ecalifornica.jpeg">&nbsp;<img width="33px" src="static/images/profile_images/telotype.png">
                    <a href="http://www.amazon.com/Sleep-Innovations-SureTemp-Mattress-Warranty/dp/B003CT37L0/ref=sr_1_1?s=home-garden&ie=UTF8&qid=1391076900&sr=1-1&keywords=sleep+innovations">
                        <h4>Amazon memory foam mattress</h4>
                        <span><img style="margin-left:-4px;" src="static/images/stars_reviews_2b.png"></span>
                </a>
                        <span style="font-size:90%;padding-left:20px;">1,410 customer reviews</span>
                </div>
                
                <div class="row marketing">
                        <button type="button" name="test" class="btn btn-default btn-success" id="barfer">
                        <span style="font-size:150%;" class="glyphicon glyphicon-ok">
                        <h4>$682</h4>
                        </span>
                        </button>  
                    &nbsp;<img width="33px" src="static/images/profile_images/ecalifornica.jpeg">&nbsp;<img width="33px" src="static/images/profile_images/telotype.png">
                    <img width="33px" src="static/images/profile_images/clairedeleony.jpeg">&nbsp;<img width="33px" src="static/images/profile_images/jberthume.jpeg">
<img width="33px" src="static/images/profile_images/lubolicious.jpg">

                        <a href="http://shop.keetsa.com/products/the-keetsa-plus">
                <h4>Keetsa eco-friendly coil mattress.</h4>
            </a>
                <p style="font-size:95%;">I own this mattress and enjoy it.</p>
                </div>
                <!--
                <div class="row marketing" style="margin-top:50px;">
                    <h4>Top pledge chooses his sheets.
                    </h4>
                    <img src="static/images/mickey_sheets.jpg" width="275px">
                </div>
                -->
           </div>
           <!--
          <p>I haven't implemented this yet, but I'd like you to help me pick which mattress we purchase for him. These are just a few examples I grabbed quickly. Please send suggestions.</p>
<div style="margin-bottom:30px;">
    <a href="http://www.amazon.com/Sleep-Master-8-Inch-Pocketed-Mattress/dp/B006L7RTKU/ref=sr_1_3?s=furniture&ie=UTF8&qid=1390415010&sr=1-3"><img src="static/images/amazon_spring_mattress.jpg" width="150px"><img width="300px" src="static/images/amazon_spring_price.png"></a>
</div>

<div style="margin-bottom:30px;">
<img src="static/images/amazon_foam_mattress.jpg" width="150px"><img width="300px" src="static/images/amazon_foam_price.png">
</div>

<div>
<img src="static/images/keetsa_price.png" width="350px">
</div>
-->


      </div>

      <div class="footer">
          <p><a href="https://twitter.com/ecalifornica">@ecalifornica</a> <a href="https://twitter.com/search?q=%23hackweek&src=hash">#hackweek</a></p>
      </div>

    </div> <!-- /container -->


<script src="https://checkout.stripe.com/checkout.js"></script>

<!--
<script>
  var handler = StripeCheckout.configure({
    key: 'pk_test_6pRNASCoBOKtIshFeQd4XMUh',
    image: '/square-image.png',
    token: function(token, args) {
      // Use the token to create the charge with a server-side script.
    }
  });

  document.getElementById('customButton').addEventListener('click', function(e) {
    // Open Checkout with further options
    handler.open({
      name: 'Happy Birthday Sohrob!',
      description: 'Pledge (${{ amount }})',
      amount: 2000
    });
    e.preventDefault();
  });
</script>
-->

<script>

    var margin = {top: 20, right: 100, bottom: 30, left: 40},    
    width = 250 - margin.left - margin.right,
    height = 850 - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .rangeRound([height, 0]);

var color = d3.scale.ordinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

    var xAxis = d3.svg.axis()    
    .scale(x)    
    .orient("bottom");

var yAxis = d3.svg.axis()    
.scale(y)    
.orient("left")    
.tickFormat(d3.format(".0%"));

var svg = d3.select("#barf").append("svg")
.attr("width", width + margin.left + margin.right)    
.attr("height", height + margin.top + margin.bottom)  
.append("g")
.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
//.append("svg:a")
//.attr("xlink:href", function(d) { return d.name; })
;

//d3.csv("static/data.csv", function(error, data) {  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "State"; }));
d3.csv("/tmp/data.csv", function(error, data) {  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "State"; }));

  data.forEach(function(d) {
    var y0 = 0;
    d.ages = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
    d.ages.forEach(function(d) { d.y0 /= y0; d.y1 /= y0; });
  });

  data.sort(function(a, b) { return b.ages[0].y1 - a.ages[0].y1; });

  x.domain(data.map(function(d) { return d.State; }));

  /*
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
      */

  var state = svg.selectAll(".state")
      .data(data)
    .enter().append("g")
      .attr("class", "state")
      .attr("transform", function(d) { return "translate(" + x(d.State) + ",0)"; });

  state.selectAll("rect")
      .data(function(d) { return d.ages; })
    .enter().append("rect")
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.y1); })
      .attr("height", function(d) { return y(d.y0) - y(d.y1); })
      .style("fill", function(d) { return color(d.name); });

  var legend = svg.select(".state:last-child").selectAll(".legend")
      .data(function(d) { return d.ages; })
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d) { return "translate(" + x.rangeBand() / 1.05 + "," + y((d.y0 + d.y1) / 2) + ")"; });

  legend.append("line")
      .attr("x2", 10);

  legend.append("text")
      .attr("x", 13)
      .attr("dy", ".35em")
      .text(function(d) { return d.name; });

});

</script>
<!--<script type="text/javascript" src="{{ url_for('static', filename='test.js') }}"></script>-->
    {% endblock %}

